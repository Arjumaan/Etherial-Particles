<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etherial Particles | Gesture & Voice Control</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Dependencies -->
    <!-- Three.js (Modules preferred now, utilizing CDN for ES modules if needed, but keeping script tags for compatibility with established libs or using global variables if libs are global) -->
    <!-- NOTE: The user's environment might prefer global scripts for ease unless a bundler is used. 
         My main.js uses 'import', so we must treat it as type="module". 
         However, the THREE examples files (OrbitControls, etc.) often expect global THREE. 
         To fix this without a bundler, we use the global script tags for THREE, 
         and let the modules access 'THREE' from the global window object or init code. 
         But standard ES modules won't see 'THREE' unless defined. 
         Correction: In modern browsers, global scripts define window.THREE. 
         But simple imports in main.js will look for files.
         Strategy: Use script tags for libraries to populate 'window', and main.js as module. -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- Post Processing Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

    <!-- MediaPipe Hands -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>

<body>
    <!-- ERROR LOGGER -->
    <div id="error-log"
        style="position:fixed; top:0; left:0; width:100%; height:200px; background:rgba(255,0,0,0.8); color:white; pointer-events:none; z-index:9999; overflow:auto; display:none; padding:10px; font-family:monospace; font-size:12px;">
    </div>
    <script>
        window.onerror = function (msg, url, line, col, error) {
            const div = document.getElementById('error-log');
            div.style.display = 'block';
            div.innerHTML += `<div>[ERROR] ${msg} <br> ${url}:${line}:${col}</div>`;
            return false;
        };
        console.log = (function (oldLog) {
            return function (message) {
                oldLog.apply(console, arguments);
                // Optional: Print specific logs to screen if needed
            };
        })(console.log);
    </script>

    <!-- Main 3D Canvas -->
    <canvas id="main-canvas"></canvas>

    <!-- Loading Screen -->
    <div id="loading">
        <div class="spinner"></div>
        <div style="font-family: var(--font-family); letter-spacing: 2px;">INITIALIZING CORE...</div>
    </div>

    <!-- Text Input -->
    <div id="text-input-container">
        <input type="text" id="particle-text-input" placeholder="TYPE TO MANIFEST..." autocomplete="off">
    </div>

    <!-- Hidden Video Input (Source) -->
    <video id="input_video"></video>

    <!-- Camera Feedback (Holo-View) -->
    <div id="cam-container">
        <canvas id="output_canvas"></canvas>
        <div id="cam-overlay">SKELETAL TRACKING V2.2</div>
    </div>

    <!-- Voice Feedback -->
    <div id="voice-indicator">Listening...</div>

    <!-- Stats -->
    <div id="stats">FPS: 60 | PARTICLES: 262K (GPU)</div>

    <!-- UI Container -->
    <div id="ui-container">
        <h2 class="glitch" data-text="ETHERIAL CORE">ETHERIAL CORE</h2>

        <div class="toggle-row">
            <button id="btn-audio" class="toggle-btn">MIC OFF</button>
            <button id="btn-synth" class="toggle-btn">SYNTH OFF</button>
            <button id="btn-voice" class="toggle-btn">VOICE OFF</button>
            <button id="btn-fs" class="toggle-btn" style="width:40px;">â›¶</button>
        </div>

        <div class="control-group">
            <label>Shape Topology</label>
            <div class="template-grid" id="template-buttons">
                <button data-shape="sphere" class="active">Sphere</button>
                <button data-shape="hearts">Hearts</button>
                <button data-shape="flower">Flower</button>
                <button data-shape="saturn">Saturn</button>
                <button data-shape="buddha">Buddha</button>
                <button data-shape="fireworks">Fireworks</button>
            </div>
        </div>

        <div class="control-group">
            <label>Photon Frequency</label>
            <div class="color-picker-wrapper">
                <input type="color" id="color-picker" value="#00d2ff">
            </div>
        </div>

        <div id="status">
            <div class="status-dot" id="status-dot"></div>
            <span id="status-text">INITIALIZING SENSORS...</span>
        </div>
    </div>

    <!-- Application Module -->
    <script type="module" src="js/main.js"></script>
</body>

</html>